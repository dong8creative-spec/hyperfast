<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>보안 문서 뷰어</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <style>
        /* 1. 기본 설정 */
        body { margin: 0; background-color: #525659; overflow-x: hidden; user-select: none; }
        
        /* 2. 로그인(식별코드 입력) 화면 */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        input { padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 5px; width: 250px; text-align: center; }
        button { margin-top: 10px; padding: 15px 30px; font-size: 18px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; }

        /* 3. PDF가 보여질 영역 */
        #pdf-container {
            display: flex; flex-direction: column; align-items: center; padding: 20px 0;
            display: none; /* 암호 입력 전에는 숨김 */
        }
        canvas {
            margin-bottom: 20px; box-shadow: 0 0 15px rgba(0,0,0,0.5);
            max-width: 100%; height: auto;
        }

        /* 4. 둥둥 떠다니는 워터마크 (애니메이션) */
        #watermark-layer {
            position: fixed; top: -50%; left: -50%; width: 200%; height: 200%;
            pointer-events: none; /* 클릭 통과 (필수) */
            z-index: 999;
            display: flex; flex-wrap: wrap; justify-content: space-around; align-content: space-around;
            transform: rotate(-30deg); /* 대각선 기울기 */
            animation: floatMove 60s linear infinite; /* 60초 동안 천천히 움직임 */
            opacity: 0.15; /* 투명도 조절 */
            display: none; /* 암호 입력 전 숨김 */
        }

        .watermark-text {
            width: 300px; height: 150px;
            font-size: 24px; font-weight: bold; color: #000;
            display: flex; align-items: center; justify-content: center;
        }

        /* 워터마크가 천천히 움직이는 동작 정의 */
        @keyframes floatMove {
            0% { transform: rotate(-30deg) translate(0, 0); }
            50% { transform: rotate(-30deg) translate(-50px, -50px); }
            100% { transform: rotate(-30deg) translate(0, 0); }
        }
    </style>
</head>
<body oncontextmenu="return false" ondragstart="return false">

    <div id="login-overlay">
        <h2>보안 문서 열람</h2>
        <p>발급받은 접속 코드를 입력하세요.</p>
        <input type="text" id="access-code" placeholder="코드를 입력하세요">
        <button onclick="startViewer()">문서 열기</button>
    </div>

    <div id="pdf-container"></div>

    <div id="watermark-layer"></div>

    <script>
        // ★★★ 설정 부분: 여기에 PDF 파일명을 적으세요 ★★★
        const url = './sample.pdf'; // 같은 폴더에 있는 파일명 (예: lecture_01.pdf)

        // PDF.js 설정
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        // 1. 뷰어 시작 함수 (버튼 클릭 시 실행)
        function startViewer() {
            const code = document.getElementById('access-code').value;
            if(code.trim().length > 0) {
                document.getElementById('login-overlay').style.display = 'none'; // 로그인창 끔
                document.getElementById('pdf-container').style.display = 'flex'; // PDF창 켬
                document.getElementById('watermark-layer').style.display = 'flex'; // 워터마크 켬
                
                // 워터마크 생성 실행
                createWatermark(code); 
                // PDF 렌더링 실행
                renderPDF();
            } else {
                alert("코드를 입력해주세요.");
            }
        }

        // 2. PDF를 읽어서 화면에 뿌려주는 함수
        async function renderPDF() {
            try {
                const pdf = await pdfjsLib.getDocument(url).promise;
                const container = document.getElementById('pdf-container');

                // 페이지 수만큼 반복
                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    
                    // 모바일/PC 화면 크기에 맞춰 배율 조정 (기본 1.5배 선명하게)
                    const scale = 1.5;
                    const viewport = page.getViewport({ scale: scale });

                    // 캔버스(그림판) 생성
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    // 캔버스를 화면에 추가
                    container.appendChild(canvas);

                    // PDF 페이지를 캔버스에 그리기
                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;
                }
            } catch (error) {
                console.error(error);
                alert("PDF 파일을 찾을 수 없습니다. 파일명을 확인해주세요.\n(서버에 업로드해야 작동합니다)");
            }
        }

        // 3. 움직이는 워터마크 만드는 함수
        function createWatermark(text) {
            const layer = document.getElementById('watermark-layer');
            // 화면을 뒤덮을 만큼 많이 생성 (약 60개)
            for(let i=0; i<60; i++) {
                const div = document.createElement('div');
                div.className = 'watermark-text';
                div.innerText = text + " (유출금지)";
                layer.appendChild(div);
            }
        }
    </script>
</body>
</html>
