<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>초고속 편집 실무반</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <style>
        /* 기본 설정 */
        body { margin: 0; background-color: #525659; overflow-x: hidden; user-select: none; font-family: 'pretendard', 'Noto Sans KR', sans-serif;}
        * { box-sizing: border-box; }

        /* 1. 로그인 레이아웃 컨테이너 */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: flex;
            overflow-y: auto; /* 화면이 너무 작을 경우 스크롤 허용 */
        }

        /* 2. 왼쪽: 이미지 영역 (1:1 비율 고정 핵심 CSS) */
        .login-left-image {
            width: 50%; /* 기본 너비 50% */
            aspect-ratio: 1 / 1; /* ★핵심: 항상 정사각형 비율 유지★ */
            max-height: 100vh; /* 화면 높이보다 커지는 것 방지 */
            background-color: #f0f0f0;
            display: flex; justify-content: center; align-items: center; 
            overflow: hidden;
            flex-shrink: 0; /* 비율 유지를 위해 줄어들지 않음 */
        }
        .login-left-image img { 
            width: 100%; height: 100%; 
            object-fit: cover; /* 이미지가 정사각형 영역을 꽉 채우도록 설정 */
        }

        /* 3. 오른쪽: 입력 폼 영역 */
        .login-right-form {
            flex: 1; /* 남은 공간 차지 */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 40px; background: white;
            min-height: 500px; /* 최소 높이 확보 */
        }

        /* 폼 스타일링 */
        .form-container { width: 100%; max-width: 400px; text-align: center; }
        h2 { font-size: 32px; margin-bottom: 10px; color: #333; }
        p.desc { color: #666; margin-bottom: 40px; line-height: 1.5; }
        input { 
            padding: 15px; font-size: 18px; border: 2px solid #ddd; border-radius: 8px; 
            width: 100%; text-align: center; margin-bottom: 15px; transition: all 0.3s;
        }
        input:focus { border-color: #333; outline: none; }
        button { 
            padding: 15px; font-size: 18px; background: #222; color: white; 
            border: none; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold;
            transition: background 0.3s;
        }
        button:hover { background: #555; }

        /* PDF 영역 스타일 */
        #pdf-container {
            display: flex; flex-direction: column; align-items: center; padding: 20px 0; display: none; 
        }
        canvas {
            margin-bottom: 20px; box-shadow: 0 5px 25px rgba(0,0,0,0.5); max-width: 100%; height: auto;
        }

        /* 워터마크 스타일 */
        #watermark-layer {
            position: fixed; top: -50%; left: -50%; width: 200%; height: 200%;
            pointer-events: none; z-index: 999;
            display: flex; flex-wrap: wrap; justify-content: space-around; align-content: space-around;
            transform: rotate(-30deg); animation: floatMove 60s linear infinite;
            opacity: 0.15; display: none;
        }
        .watermark-text {
            width: 300px; height: 150px; font-size: 24px; font-weight: bold; color: #000;
            display: flex; align-items: center; justify-content: center;
        }
        @keyframes floatMove {
            0% { transform: rotate(-30deg) translate(0, 0); }
            50% { transform: rotate(-30deg) translate(-50px, -50px); }
            100% { transform: rotate(-30deg) translate(0, 0); }
        }

        /* 모바일 반응형 (좁은 화면) */
        @media (max-width: 900px) {
            #login-overlay { 
                flex-direction: column; /* 위아래 배치 */
                height: auto; min-height: 100vh; /* 스크롤 가능하게 변경 */
                position: absolute; /* 고정 해제 */
            }
            .login-left-image { 
                width: 100%; /* 너비 100% */
                aspect-ratio: 1 / 1; /* ★모바일에서도 정사각형 유지★ */
                max-height: none; /* 높이 제한 해제 */
            }
            .login-right-form { 
                width: 100%; padding: 60px 20px; flex: none; 
                min-height: auto; 
            }
            h2 { font-size: 24px; }
        }
    </style>
</head>
<body oncontextmenu="return false" ondragstart="return false">

    <div id="login-overlay">
        <div class="login-left-image">
            <img src="https://via.placeholder.com/1000x1000.png?text=SQUARE+IMAGE+1:1" alt="강의 대표 이미지.jpg">
        </div>

        <div class="login-right-form">
            <div class="form-container">
                <h2>보안 자료 열람</h2>
                <p class="desc">발급받으신 보안 코드를 입력해주십시오.<br>접속 기록 및 IP가 워터마크로 기록됩니다.</p>
                <input type="text" id="access-code" placeholder="보안 코드 입력">
                <button onclick="startViewer()">입장하기</button>
            </div>
        </div>
    </div>

    <div id="pdf-container"></div>
    <div id="watermark-layer"></div>

    <script>
        // ★★★ 설정 1: PDF 파일명 ★★★
        const url = './hyperfast.pdf'; 

        // ★★★ 설정 2: 입장 가능한 코드 목록 (4개) ★★★
        const validCodes = ['931122', '6946', '1210', 'vip1210'];

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

        function startViewer() {
            const inputCode = document.getElementById('access-code').value.trim();
            
            if(validCodes.includes(inputCode)) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('pdf-container').style.display = 'flex';
                document.getElementById('watermark-layer').style.display = 'flex';
                
                createWatermark(inputCode); 
                renderPDF();
            } else {
                alert("유효하지 않은 보안 코드입니다.\n다시 확인해주세요.");
            }
        }

        async function renderPDF() {
            try {
                const pdf = await pdfjsLib.getDocument(url).promise;
                const container = document.getElementById('pdf-container');

                for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                    const page = await pdf.getPage(pageNum);
                    // PC에서 이미지가 너무 크면 이 scale 값을 1.5 -> 1.2 정도로 줄이세요
                    const scale = 1.5; 
                    const viewport = page.getViewport({ scale: scale });

                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;

                    container.appendChild(canvas);

                    await page.render({
                        canvasContext: context,
                        viewport: viewport
                    }).promise;
                }
            } catch (error) {
                console.error(error);
                alert("PDF 로딩 실패. 서버에 업로드 되었는지 확인하세요.");
            }
        }

        function createWatermark(text) {
            const layer = document.getElementById('watermark-layer');
            for(let i=0; i<60; i++) {
                const div = document.createElement('div');
                div.className = 'watermark-text';
                div.innerText = text; 
                layer.appendChild(div);
            }
        }
    </script>
</body>
</html>
